#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–≥–æ –∏–Ω—Å—Ç–∞–ª–ª—è—Ç–æ—Ä–∞ —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –Ω–µ—Ñ—Ç–µ–ø—Ä–æ–≤–æ–¥–∞
"""

import os
import shutil
import zipfile

def create_installer():
    """–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–≥–æ zip-–∏–Ω—Å—Ç–∞–ª–ª—è—Ç–æ—Ä–∞"""
    print("=== –°–û–ó–î–ê–ù–ò–ï –ò–ù–°–¢–ê–õ–õ–Ø–¢–û–†–ê –°–ò–°–¢–ï–ú–´ –ú–û–ù–ò–¢–û–†–ò–ù–ì–ê ===\n")
    
    # –ò–º—è –∞—Ä—Ö–∏–≤–∞
    installer_name = "MonOilStudy_Installer.zip"
    
    # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –∞—Ä—Ö–∏–≤ –µ—Å–ª–∏ –µ—Å—Ç—å
    if os.path.exists(installer_name):
        os.remove(installer_name)
    
    # –°–æ–∑–¥–∞–µ–º zip –∞—Ä—Ö–∏–≤
    with zipfile.ZipFile(installer_name, 'w', zipfile.ZIP_DEFLATED) as zipf:
        
        # –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∞–π–ª—ã –∏–∑ –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–∞
        dist_dir = "MonOilStudy_Distribution"
        if os.path.exists(dist_dir):
            for root, dirs, files in os.walk(dist_dir):
                for file in files:
                    file_path = os.path.join(root, file)
                    arcname = os.path.relpath(file_path, dist_dir)
                    zipf.write(file_path, arcname)
                    print(f"–î–æ–±–∞–≤–ª–µ–Ω: {arcname}")
        
        # –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ
        install_instructions = """=== –ò–ù–°–¢–†–£–ö–¶–ò–ò –ü–û –£–°–¢–ê–ù–û–í–ö–ï ===

1. –†–ê–°–ü–ê–ö–£–ô–¢–ï –ê–†–•–ò–í –≤ –ª—é–±—É—é –ø–∞–ø–∫—É –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ

2. –£–°–¢–ê–ù–û–í–ò–¢–ï PYTHON:
   - –°–∫–∞—á–∞–π—Ç–µ Python 3.7+ —Å https://python.org
   - –ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –æ—Ç–º–µ—Ç—å—Ç–µ "Add Python to PATH"

3. –£–°–¢–ê–ù–û–í–ò–¢–ï –ó–ê–í–ò–°–ò–ú–û–°–¢–ò (—Ç–æ–ª—å–∫–æ –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –ë–î):
   - –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É (cmd)
   - –í—ã–ø–æ–ª–Ω–∏—Ç–µ: pip install PyQt5

4. –ó–ê–ü–£–°–ö –ü–†–û–ì–†–ê–ú–ú:
   - –î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –Ω–∞ run_monitor.bat - –æ—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞
   - –î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –Ω–∞ run_db_manager.bat - –º–µ–Ω–µ–¥–∂–µ—Ä –ë–î

5. –û–°–û–ë–ï–ù–ù–û–°–¢–ò:
   - –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ø–∞–ø–∫–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã
   - –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –ø–∞–ø–∫—É –Ω–∞ –¥—Ä—É–≥–æ–π –∫–æ–º–ø—å—é—Ç–µ—Ä
   - –ü–∞–ø–∫–∞ reports —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

6. –ü–†–û–ë–õ–ï–ú–´:
   - "Python –Ω–µ –Ω–∞–π–¥–µ–Ω" - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Python –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ PATH
   - "PyQt5 –Ω–µ –Ω–∞–π–¥–µ–Ω" - –≤—ã–ø–æ–ª–Ω–∏—Ç–µ: pip install PyQt5

–¢–ï–•–ü–û–î–î–ï–†–ñ–ö–ê: –ó—É–±–µ–Ω–∫–æ –ú–∏—Ö–∞–∏–ª –ü–µ—Ç—Ä–æ–≤–∏—á
"""
        
        zipf.writestr("–£–°–¢–ê–ù–û–í–ö–ê.txt", install_instructions.encode('utf-8'))
        print("–î–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ")
    
    print(f"\n=== –ò–ù–°–¢–ê–õ–õ–Ø–¢–û–† –°–û–ó–î–ê–ù ===")
    print(f"üì¶ –§–∞–π–ª: {installer_name}")
    print("üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:")
    print("1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ zip-–∞—Ä—Ö–∏–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é")
    print("2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ—Ç –∞—Ä—Ö–∏–≤")
    print("3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç Python (–µ—Å–ª–∏ –Ω–µ—Ç)")
    print("4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—É—Å–∫–∞–µ—Ç .bat —Ñ–∞–π–ª—ã")
    print("\n‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é!")

def create_standalone_installer():
    """–°–æ–∑–¥–∞–Ω–∏–µ self-extracting –∏–Ω—Å—Ç–∞–ª–ª—è—Ç–æ—Ä–∞ (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ)"""
    try:
        # –°–æ–∑–¥–∞–µ–º bat-—Ñ–∞–π–ª –∏–Ω—Å—Ç–∞–ª–ª—è—Ç–æ—Ä
        installer_bat = """@echo off
echo === –£–°–¢–ê–ù–û–í–ö–ê –°–ò–°–¢–ï–ú–´ –ú–û–ù–ò–¢–û–†–ò–ù–ì–ê –ù–ï–§–¢–ï–ü–†–û–í–û–î–ê ===
echo.

set INSTALL_DIR=%~dp0MonOilStudy
echo –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤: %INSTALL_DIR%

if exist "%INSTALL_DIR%" (
    echo –ü–∞–ø–∫–∞ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é...
    rmdir /s /q "%INSTALL_DIR%"
)

echo –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É —É—Å—Ç–∞–Ω–æ–≤–∫–∏...
mkdir "%INSTALL_DIR%"

echo –ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã...
xcopy /s /e /q MonOilStudy_Distribution\\* "%INSTALL_DIR%\\"

echo.
echo === –£–°–¢–ê–ù–û–í–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê ===
echo.
echo –ü—Ä–æ–≥—Ä–∞–º–º–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –≤: %INSTALL_DIR%
echo.
echo –î–ª—è –∑–∞–ø—É—Å–∫–∞:
echo - %INSTALL_DIR%\\run_monitor.bat (–æ—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞)
echo - %INSTALL_DIR%\\run_db_manager.bat (–º–µ–Ω–µ–¥–∂–µ—Ä –ë–î)
echo.
echo –í–ù–ò–ú–ê–ù–ò–ï: –î–ª—è —Ä–∞–±–æ—Ç—ã —Ç—Ä–µ–±—É–µ—Ç—Å—è Python 3.7+ –∏ PyQt5
echo –î–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ PyQt5: pip install PyQt5
echo.
pause
"""
        
        with open('install.bat', 'w', encoding='cp1251') as f:
            f.write(installer_bat)
        
        print("–°–æ–∑–¥–∞–Ω batch-–∏–Ω—Å—Ç–∞–ª–ª—è—Ç–æ—Ä: install.bat")
        
    except Exception as e:
        print(f"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å batch-–∏–Ω—Å—Ç–∞–ª–ª—è—Ç–æ—Ä: {e}")

if __name__ == "__main__":
    create_installer()
    create_standalone_installer() 