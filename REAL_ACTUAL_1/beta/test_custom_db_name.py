#!/usr/bin/env python3  # —ç—Ç–∞ —Å—Ç—Ä–æ–∫–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç —Å–∏—Å—Ç–µ–º–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Python 3 –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞
# -*- coding: utf-8 -*-  # —ç—Ç–∞ —Å—Ç—Ä–æ–∫–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–¥–∏—Ä–æ–≤–∫—É —Ñ–∞–π–ª–∞ - UTF-8 (–¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä—É—Å—Å–∫–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤)
"""
–¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –∏–º–µ–Ω–µ–º
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –¥–∏–∞–ª–æ–≥–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ë–î –≤ –ø—Ä–æ–≥—Ä–∞–º–º–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
"""  # –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π, –æ–ø–∏—Å—ã–≤–∞—é—â–∏–π –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞

import sys  # –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é –º–æ–¥—É–ª—å sys –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏
import os  # –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é –º–æ–¥—É–ª—å os –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π (—Ñ–∞–π–ª—ã, –ø–∞–ø–∫–∏)
import sqlite3  # –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é –º–æ–¥—É–ª—å sqlite3 –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö SQLite
from PyQt5.QtWidgets import QApplication, QMessageBox, QInputDialog  # –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é –∫–ª–∞—Å—Å—ã –∏–∑ PyQt5 –¥–ª—è –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:
# QApplication - –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
# QMessageBox - –≤—Å–ø–ª—ã–≤–∞—é—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
# QInputDialog - –¥–∏–∞–ª–æ–≥–∏ –¥–ª—è –≤–≤–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö
from PyQt5.QtCore import Qt  # –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é –±–∞–∑–æ–≤—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏ PyQt5

# –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é –ø–∞–ø–∫—É –≤ –ø—É—Ç—å –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –º–æ–¥—É–ª–µ–π
sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))  # –¥–æ–±–∞–≤–ª—è—é —Ç–µ–∫—É—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ —Å–ø–∏—Å–æ–∫ –ø—É—Ç–µ–π –ø–æ–∏—Å–∫–∞ –º–æ–¥—É–ª–µ–π Python
# os.path.abspath(__file__) - –ø–æ–ª—É—á–∞—é –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å –∫ —Ç–µ–∫—É—â–µ–º—É —Ñ–∞–π–ª—É
# os.path.dirname() - –ø–æ–ª—É—á–∞—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é, –≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Ñ–∞–π–ª
# sys.path.insert(0, ...) - –¥–æ–±–∞–≤–ª—è—é —ç—Ç—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ –Ω–∞—á–∞–ª–æ —Å–ø–∏—Å–∫–∞ –ø—É—Ç–µ–π –ø–æ–∏—Å–∫–∞

def test_custom_db_creation():  # –æ–ø—Ä–µ–¥–µ–ª—è—é —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –ë–î —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –∏–º–µ–Ω–µ–º
    """
    –¢–µ—Å—Ç–∏—Ä—É–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –ë–î —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –∏–º–µ–Ω–µ–º
    """  # –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π, –æ–ø–∏—Å—ã–≤–∞—é—â–∏–π —á—Ç–æ –¥–µ–ª–∞–µ—Ç —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è
    print("üß™ –ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ë–î —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –∏–º–µ–Ω–µ–º...")  # –≤—ã–≤–æ–∂—É —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–∞—á–∞–ª–µ —Ç–µ—Å—Ç–∞
    
    # –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    app = QApplication(sys.argv)  # —Å–æ–∑–¥–∞—é –æ–±—ä–µ–∫—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è PyQt5, –ø–µ—Ä–µ–¥–∞—é –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
    
    try:  # –Ω–∞—á–∏–Ω–∞—é –±–ª–æ–∫ try –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –æ—à–∏–±–æ–∫
        # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∫–ª–∞—Å—Å –¥–∏–∞–ª–æ–≥–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ë–î
        from importlib import import_module  # –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞ –º–æ–¥—É–ª–µ–π
        db_man_module = import_module("DB man_0.1")  # –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é –º–æ–¥—É–ª—å "DB man_0.1" –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
        CreateDBDialog = db_man_module.CreateDBDialog  # –ø–æ–ª—É—á–∞—é –∫–ª–∞—Å—Å CreateDBDialog –∏–∑ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –º–æ–¥—É–ª—è
        
        print("‚úÖ –ú–æ–¥—É–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ë–î —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω")  # –≤—ã–≤–æ–∂—É —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º –∏–º–ø–æ—Ä—Ç–µ
        
        # –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –¥–∏–∞–ª–æ–≥–∞
        dialog = CreateDBDialog()  # —Å–æ–∑–¥–∞—é –æ–±—ä–µ–∫—Ç –¥–∏–∞–ª–æ–≥–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ë–î
        print("‚úÖ –î–∏–∞–ª–æ–≥ —Å–æ–∑–¥–∞–Ω–∏—è –ë–î —Å–æ–∑–¥–∞–Ω")  # –≤—ã–≤–æ–∂—É —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º —Å–æ–∑–¥–∞–Ω–∏–∏ –¥–∏–∞–ª–æ–≥–∞
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –º–µ—Ç–æ–¥–∞ create_sqlite_db
        if hasattr(dialog, 'create_sqlite_db'):
            print("‚úÖ –ú–µ—Ç–æ–¥ create_sqlite_db –Ω–∞–π–¥–µ–Ω")
        else:
            print("‚ùå –ú–µ—Ç–æ–¥ create_sqlite_db –Ω–µ –Ω–∞–π–¥–µ–Ω")
            return False
            
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ PyQt5.QtWidgets.QInputDialog –≤ –º–µ—Ç–æ–¥–µ
        import inspect
        source = inspect.getsource(dialog.create_sqlite_db)
        if 'QInputDialog.getText' in source:
            print("‚úÖ QInputDialog.getText –Ω–∞–π–¥–µ–Ω –≤ –º–µ—Ç–æ–¥–µ create_sqlite_db")
        else:
            print("‚ùå QInputDialog.getText –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –º–µ—Ç–æ–¥–µ")
            return False
            
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–º–µ–Ω–∏ –ë–î
        if 'db_name, ok = QInputDialog.getText' in source:
            print("‚úÖ –õ–æ–≥–∏–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∏–º–µ–Ω–∏ –ë–î –Ω–∞–π–¥–µ–Ω–∞")
        else:
            print("‚ùå –õ–æ–≥–∏–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∏–º–µ–Ω–∏ –ë–î –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
            return False
            
        if "if not db_name.endswith('.db'):" in source:
            print("‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è .db –Ω–∞–π–¥–µ–Ω–∞")
        else:
            print("‚ùå –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è .db –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
            return False
            
        print("‚úÖ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!")
        return True
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏: {e}")
        return False
    finally:
        app.quit()

def test_db_file_creation():
    """
    –¢–µ—Å—Ç–∏—Ä—É–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –ë–î
    """
    print("\nüß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –ë–î...")
    
    # –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—É—é –ë–î —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –∏–º–µ–Ω–µ–º
    test_name = "test_custom_database.db"
    test_path = os.path.join(os.getcwd(), test_name)
    
    try:
        # –£–¥–∞–ª—è–µ–º —Ñ–∞–π–ª –µ—Å–ª–∏ –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        if os.path.exists(test_path):
            os.remove(test_path)
        
        # –°–æ–∑–¥–∞–µ–º –ë–î –∫–∞–∫ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º–∞
        conn = sqlite3.connect(test_path)
        conn.execute("""CREATE TABLE IF NOT EXISTS raw_data (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            operator_fio TEXT,
            cell_id INTEGER,
            cell_pressure REAL,
            timestamp TEXT
        );""")
        conn.execute("""INSERT INTO raw_data 
            (operator_fio, cell_id, cell_pressure, timestamp)
            VALUES (?, ?, ?, ?)""",
            ("–¢–µ—Å—Ç–æ–≤—ã–π –û–ø–µ—Ä–∞—Ç–æ—Ä", 1, 50.0, "2023-01-01 12:00:00"))
        conn.commit()
        conn.close()
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Ñ–∞–π–ª —Å–æ–∑–¥–∞–ª—Å—è
        if os.path.exists(test_path):
            print(f"‚úÖ –§–∞–π–ª –ë–î {test_name} —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω")
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
            conn = sqlite3.connect(test_path)
            cursor = conn.cursor()
            cursor.execute("SELECT COUNT(*) FROM raw_data")
            count = cursor.fetchone()[0]
            conn.close()
            
            if count > 0:
                print(f"‚úÖ –í –ë–î –Ω–∞–π–¥–µ–Ω–æ {count} –∑–∞–ø–∏—Å–µ–π")
            else:
                print("‚ùå –ë–î –ø—É—Å—Ç–∞")
                return False
                
            # –£–¥–∞–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª
            os.remove(test_path)
            print("‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª —É–¥–∞–ª–µ–Ω")
            return True
        else:
            print("‚ùå –§–∞–π–ª –ë–î –Ω–µ –±—ã–ª —Å–æ–∑–¥–∞–Ω")
            return False
            
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ë–î: {e}")
        return False

if __name__ == "__main__":
    print("=" * 60)
    print("–¢–ï–°–¢ –°–û–ó–î–ê–ù–ò–Ø –ë–î –° –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨–°–ö–ò–ú –ò–ú–ï–ù–ï–ú")
    print("=" * 60)
    
    # –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
    success1 = test_custom_db_creation()
    
    # –¢–µ—Å—Ç 2: –†–µ–∞–ª—å–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
    success2 = test_db_file_creation()
    
    print("\n" + "=" * 60)
    print("–†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø:")
    print("=" * 60)
    print(f"–¢–µ—Å—Ç –∫–æ–¥–∞ –¥–∏–∞–ª–æ–≥–∞: {'‚úÖ –ü–†–û–ô–î–ï–ù' if success1 else '‚ùå –ü–†–û–í–ê–õ–ï–ù'}")
    print(f"–¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–∞–π–ª–∞: {'‚úÖ –ü–†–û–ô–î–ï–ù' if success2 else '‚ùå –ü–†–û–í–ê–õ–ï–ù'}")
    
    if success1 and success2:
        print("\nüéâ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´ –£–°–ü–ï–®–ù–û!")
        print("‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –ë–î —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –∏–º–µ–Ω–µ–º —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ")
    else:
        print("\n‚ùå –ù–ï–ö–û–¢–û–†–´–ï –¢–ï–°–¢–´ –ü–†–û–í–ê–õ–ï–ù–´")
        
    print("=" * 60) 